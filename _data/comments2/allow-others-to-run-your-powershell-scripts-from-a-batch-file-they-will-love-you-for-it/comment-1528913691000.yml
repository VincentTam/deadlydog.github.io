name: Rob Peterson
date: '2018-06-13 12:14:51'
url: ''
message: "Not exactly sure why the batch file isn't running... the log for the script isn't created and there isn't anything in the Event Viewer.  Everything runs smoothly when running direct within PowerShell so that part is correct.  Here's the command that I'm running inside PowerShell:\r\n\r\nC:\\Password_Expiry_Email.ps1 -smtpServer smtp.gmail.com -expireInDays 10 -from \"user@domain.com\" -Logging $true -LogPath \"C:\\PasswordExpiryLogs\" -testing $true -testRecipient testuser@domain.com  \r\n\r\nThis does have to be run from the active directory module.  Here's what I have been using for the batch file (in some form or another without success):\r\n\r\n@ECHO OFF\r\nSET ThisScriptsDirectory=%~dp0\r\nSET PowerShellScriptPath=%ThisScriptsDirectory%Password_Expiry_Email.ps1\r\nPowerShell -NoProfile -ExecutionPolicy Bypass -Command import-module ActiveDirectory \"&amp; {Start-Process PowerShell -ArgumentList '-NoProfile -ExecutionPolicy Bypass -File -Command import-module ActiveDirectory \"\"\"\"%PowerShellScriptPath%\"\"\"\" -smtpServer \"\"\"\"smtp.gmail.com\"\"\"\" -expireInDays \"\"\"\"10\"\"\"\" -from \"\"\"\"user@domain.com\"\"\"\" -Logging \"\"\"\"$true\"\"\"\" -LogPath \"\"\"\"C:\\PasswordExpiryLogs\"\"\"\" -testing \"\"\"\"$true\"\"\"\" -testRecipient \"\"\"\"testuser@domain.com\"\"\"\"' -Verb RunAs}\";"
email: b12f0bedfc87a57e7e5569c0e0df1b88
