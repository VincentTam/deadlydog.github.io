name: Carl Reid
date: '2013-10-16 03:02:04'
url: ''
message: "Thanks for submitting these scripts, coincidently I was looking to write something similar for tidying up old releases and will use your scripts as a starter for mine.\r\n\r\nI did however hit problems with your Remove-EmptyDirectories function. It looks like it hits a null reference in the Get-ChildItems and then falls over when trying to access the Length property which of course doesn't exist on a null object.\r\n\r\nYou can test this by simply creating two folders under c:\\temp\r\nc:\\temp\\new1\r\nc:\\temp\\new1\\new2\r\n\r\nThen run your example:\r\nRemove-FilesNotModifiedAfterDate -Path \"C:\\Temp\" -DateTime ((Get-Date).AddDays(-2)) -DeletePathIfEmpty\r\n\r\nResults in: \r\n\r\nWhere-Object : Property 'Length' cannot be found on this object. Make sure that it exists.\r\nAt line:4 char:49\r\n+     Get-ChildItem -Path $Path -Recurse -Force | Where-Object { $_.PSIsContainer  ...\r\n+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\r\n    + CategoryInfo          : NotSpecified: (:) [Where-Object], PropertyNotFoundException\r\n    + FullyQualifiedErrorId : PropertyNotFoundStrict,Microsoft.PowerShell.Commands.WhereObjectCommand\r\n\r\nI have modified it like this which seems ok although not as concise!\r\n\r\nfunction Remove-EmptyDirectories([parameter(Mandatory=$true)][ValidateScript({Test-Path $_})][string] $Path, [switch] $DeletePathIfEmpty)\r\n{\r\n    $childDirectories = Get-ChildItem -Path $Path -Recurse -Force | Where-Object { $_.PSIsContainer } | Sort -Property @{ Expression = {$_.FullName.Split('\\').Count} } -Desc\r\n    foreach ($childDirectory in $childDirectories)\r\n    {\r\n       $childFiles = Get-ChildItem -Path $childDirectory.FullName -Recurse -Force | Where-Object { -not $childDirectory.PSIsContainer }\r\n       if (($childFiles -eq $null) -or ($childFiles.Length -eq 0))\r\n       {\r\n            Remove-Item -Path $childDirectory.FullName -Force -Recurse\r\n       }\r\n    }\r\n\r\n    # If we should delete the given path when it is empty, and it is a directory, and it is empty, then delete it.\r\n    if ($DeletePathIfEmpty -and (Test-Path -Path $Path -PathType Container) -and (Get-ChildItem -Path $Path -Force).Length -eq 0) { Remove-Item -Path $Path -Force }\r\n}\r\n\r\n\r\nCheers,\r\n\r\ncarl"
email: 798d89c2479c3ea0234ac5367d2c3357
